/******************************************************************************\
 *                                                                            * 
 *  Libcutils - library of C function                                         * 
 *                                                                            *
 *  Version:             3.4                                                  * 
 *  Date:                28/01/2017                                           *
 *                                                                            * 
 *  Author:              Zdenek Futera                                        * 
 *                                                                            * 
 *  Address:             University College London (UCL)                      * 
 *                       Department of Physics and Astronomy                  * 
 *                       Gower Street, London WC1E 6BT                        * 
 *                       United Kingdom                                       * 
 *                                                                            * 
 *  E-Mail:              z.futera@ucl.ac.uk                                   * 
 *                                                                            * 
\******************************************************************************/

#include <math.h>
#include <cmn/math.h>
#include <cmn/message.h>
#include "qmc/gto.h"

/* -------------------------------------------------------------------------- */

/* evaluate set of [r]^m auxiliary integrals from [0]^m integrals
 
   rm - array for [r]^m integrals
   lt - total angular momentum of (ab|cd)
   tt - value of T (Boys function argument)
   rr - R=P-Q vector */
short gto_int_2e_rm(
  double rm[2*(GTO_MAX_AMOM+1)+1][2*(GTO_MAX_AMOM+1)+1]
           [2*(GTO_MAX_AMOM+1)+1][4*(GTO_MAX_AMOM+1)+1],
  unsigned lt, double uu, double th, double tt, double *rr) {
  static unsigned m;
  if (lt>(2*(GTO_MAX_AMOM+1)))
    msg_error_f("total angular momentum (%d) exceeded current limit"
      " limit (%d)",1,lt,2*(GTO_MAX_AMOM+1));
  /* [0]^m integrals */
  for (m=0; m<=lt; m++)
    rm[0][0][0][m] = (uu*pow(2.0*th,m+0.5)*MATH_2r2fPI*math_boys(m,tt));
  if (lt<1) 
    return(1);
  /* [1]^m integrals */
  for (m=0; m<=(lt-1); m++) {
    rm[1][0][0][m] = rr[0]*rm[0][0][0][m+1];
    rm[0][1][0][m] = rr[1]*rm[0][0][0][m+1];
    rm[0][0][1][m] = rr[2]*rm[0][0][0][m+1];
    }
  if (lt<2) 
    return(1);
  /* [2]^m integrals */
  for (m=0; m<=(lt-2); m++) {
    /* (1,1,0) type */
    rm[1][1][0][m] = rr[1]*rm[1][0][0][m+1];
    rm[1][0][1][m] = rr[2]*rm[1][0][0][m+1];
    rm[0][1][1][m] = rr[2]*rm[0][1][0][m+1];
    /* (2,0,0) type */
    rm[2][0][0][m] = rr[0]*rm[1][0][0][m+1]-rm[0][0][0][m+1];
    rm[0][2][0][m] = rr[1]*rm[0][1][0][m+1]-rm[0][0][0][m+1];
    rm[0][0][2][m] = rr[2]*rm[0][0][1][m+1]-rm[0][0][0][m+1];
    }
  if (lt<3)
    return(1);
  /* [3]^m integrals */
  for (m=0; m<=(lt-3); m++) {
    /* (1,1,1) type */
    rm[1][1][1][m] = rr[2]*rm[1][1][0][m+1];
    /* (2,1,0) type */
    rm[2][1][0][m] = rr[0]*rm[1][1][0][m+1]-rm[0][1][0][m+1];
    rm[2][0][1][m] = rr[0]*rm[1][0][1][m+1]-rm[0][0][1][m+1];
    rm[1][2][0][m] = rr[1]*rm[1][1][0][m+1]-rm[1][0][0][m+1];
    rm[0][2][1][m] = rr[1]*rm[0][1][1][m+1]-rm[0][0][1][m+1];
    rm[1][0][2][m] = rr[2]*rm[1][0][1][m+1]-rm[1][0][0][m+1];
    rm[0][1][2][m] = rr[2]*rm[0][1][1][m+1]-rm[0][1][0][m+1];
    /* (3,0,0) type */
    rm[3][0][0][m] = rr[0]*rm[2][0][0][m+1]-2.0*rm[1][0][0][m+1];
    rm[0][3][0][m] = rr[1]*rm[0][2][0][m+1]-2.0*rm[0][1][0][m+1];
    rm[0][0][3][m] = rr[2]*rm[0][0][2][m+1]-2.0*rm[0][0][1][m+1];
    }
  if (lt<4) 
    return(1);
  /* [4]^m integrals */
  for (m=0; m<=(lt-4); m++) {
    /* (2,1,1) type */
    rm[2][1][1][m] = rr[0]*rm[1][1][1][m+1]-rm[0][1][1][m+1];
    rm[1][2][1][m] = rr[1]*rm[1][1][1][m+1]-rm[1][0][1][m+1];
    rm[1][1][2][m] = rr[2]*rm[1][1][1][m+1]-rm[1][1][0][m+1];
    /* (2,2,0) type */
    rm[2][2][0][m] = rr[1]*rm[2][1][0][m+1]-rm[2][0][0][m+1];
    rm[2][0][2][m] = rr[2]*rm[2][0][1][m+1]-rm[2][0][0][m+1];
    rm[0][2][2][m] = rr[2]*rm[0][2][1][m+1]-rm[0][2][0][m+1];
    /* (3,1,0) type */
    rm[3][1][0][m] = rr[0]*rm[2][1][0][m+1]-2.0*rm[1][1][0][m+1];
    rm[3][0][1][m] = rr[0]*rm[2][0][1][m+1]-2.0*rm[1][0][1][m+1];
    rm[1][3][0][m] = rr[1]*rm[1][2][0][m+1]-2.0*rm[1][1][0][m+1];
    rm[0][3][1][m] = rr[1]*rm[0][2][1][m+1]-2.0*rm[0][1][1][m+1];
    rm[1][0][3][m] = rr[2]*rm[1][0][2][m+1]-2.0*rm[1][0][1][m+1];
    rm[0][1][3][m] = rr[2]*rm[0][1][2][m+1]-2.0*rm[0][1][1][m+1];
    /* (4,0,0) type */
    rm[4][0][0][m] = rr[0]*rm[3][0][0][m+1]-3.0*rm[2][0][0][m+1];
    rm[0][4][0][m] = rr[1]*rm[0][3][0][m+1]-3.0*rm[0][2][0][m+1];
    rm[0][0][4][m] = rr[2]*rm[0][0][3][m+1]-3.0*rm[0][0][2][m+1];
    }
  if (lt<5)
    return(1);
  /* [5]^m integrals */
  for (m=0; m<=(lt-5); m++) {
    /* (2,2,1) type */
    rm[2][2][1][m] = rr[1]*rm[2][1][1][m+1]-rm[2][0][1][m+1];
    rm[2][1][2][m] = rr[2]*rm[2][1][1][m+1]-rm[2][1][0][m+1];
    rm[1][2][2][m] = rr[2]*rm[1][2][1][m+1]-rm[1][2][0][m+1];
    /* (3,1,1) type */
    rm[3][1][1][m] = rr[0]*rm[2][1][1][m+1]-2.0*rm[1][1][1][m+1];
    rm[1][3][1][m] = rr[1]*rm[1][2][1][m+1]-2.0*rm[1][1][1][m+1];
    rm[1][1][3][m] = rr[2]*rm[1][1][2][m+1]-2.0*rm[1][1][1][m+1];
    /* (3,2,0) type */
    rm[3][2][0][m] = rr[0]*rm[2][2][0][m+1]-2.0*rm[1][2][0][m+1];
    rm[3][0][2][m] = rr[0]*rm[2][0][2][m+1]-2.0*rm[1][0][2][m+1];
    rm[2][3][0][m] = rr[1]*rm[2][2][0][m+1]-2.0*rm[2][1][0][m+1];
    rm[0][3][2][m] = rr[1]*rm[0][2][2][m+1]-2.0*rm[0][1][2][m+1];
    rm[2][0][3][m] = rr[2]*rm[2][0][2][m+1]-2.0*rm[2][0][1][m+1];
    rm[0][2][3][m] = rr[2]*rm[0][2][2][m+1]-2.0*rm[0][2][1][m+1];
    /* (4,1,0) type */
    rm[4][1][0][m] = rr[0]*rm[3][1][0][m+1]-3.0*rm[2][1][0][m+1];
    rm[4][0][1][m] = rr[0]*rm[3][0][1][m+1]-3.0*rm[2][0][1][m+1];
    rm[1][4][0][m] = rr[1]*rm[1][3][0][m+1]-3.0*rm[1][2][0][m+1];
    rm[0][4][1][m] = rr[1]*rm[0][3][1][m+1]-3.0*rm[0][2][1][m+1];
    rm[1][0][4][m] = rr[2]*rm[1][0][3][m+1]-3.0*rm[1][0][2][m+1];
    rm[0][1][4][m] = rr[2]*rm[0][1][3][m+1]-3.0*rm[0][1][2][m+1];
    /* (5,0,0) type */
    rm[5][0][0][m] = rr[0]*rm[4][0][0][m+1]-4.0*rm[3][0][0][m+1];
    rm[0][5][0][m] = rr[1]*rm[0][4][0][m+1]-4.0*rm[0][3][0][m+1];
    rm[0][0][5][m] = rr[2]*rm[0][0][4][m+1]-4.0*rm[0][0][3][m+1];
    }
  if (lt<6)
    return(1);
  /* [6]^m integrals */
  for (m=0; m<=(lt-6); m++) {
    /* (2,2,2) type */
    rm[2][2][2][m] = rr[2]*rm[2][2][1][m+1]-rm[2][2][0][m+1];
    /* (3,2,1) type */
    rm[3][2][1][m] = rr[0]*rm[2][2][1][m+1]-2.0*rm[1][2][1][m+1];
    rm[3][1][2][m] = rr[0]*rm[2][1][2][m+1]-2.0*rm[1][1][2][m+1];
    rm[2][3][1][m] = rr[1]*rm[2][2][1][m+1]-2.0*rm[2][1][1][m+1];
    rm[1][3][2][m] = rr[1]*rm[1][2][2][m+1]-2.0*rm[1][1][2][m+1];
    rm[2][1][3][m] = rr[2]*rm[2][1][2][m+1]-2.0*rm[2][1][1][m+1];
    rm[1][2][3][m] = rr[2]*rm[1][2][2][m+1]-2.0*rm[1][2][1][m+1];
    /* (3,3,0) type */
    rm[3][3][0][m] = rr[1]*rm[3][2][0][m+1]-2.0*rm[3][1][0][m+1];
    rm[3][0][3][m] = rr[2]*rm[3][0][2][m+1]-2.0*rm[3][0][1][m+1];
    rm[0][3][3][m] = rr[2]*rm[0][3][2][m+1]-2.0*rm[0][3][1][m+1];
    /* (4,1,1) type */
    rm[4][1][1][m] = rr[0]*rm[3][1][1][m+1]-3.0*rm[2][1][1][m+1];
    rm[1][4][1][m] = rr[1]*rm[1][3][1][m+1]-3.0*rm[1][2][1][m+1];
    rm[1][1][4][m] = rr[2]*rm[1][1][3][m+1]-3.0*rm[1][1][2][m+1];
    /* (4,2,0) type */
    rm[4][2][0][m] = rr[0]*rm[3][2][0][m+1]-3.0*rm[2][2][0][m+1];
    rm[4][0][2][m] = rr[0]*rm[3][0][2][m+1]-3.0*rm[2][0][2][m+1];
    rm[2][4][0][m] = rr[1]*rm[2][3][0][m+1]-3.0*rm[2][2][0][m+1];
    rm[0][4][2][m] = rr[1]*rm[0][3][2][m+1]-3.0*rm[0][2][2][m+1];
    rm[2][0][4][m] = rr[2]*rm[2][0][3][m+1]-3.0*rm[2][0][2][m+1];
    rm[0][2][4][m] = rr[2]*rm[0][2][3][m+1]-3.0*rm[0][2][2][m+1];
    /* (5,1,0) type */
    rm[5][1][0][m] = rr[0]*rm[4][1][0][m+1]-4.0*rm[3][1][0][m+1];
    rm[5][0][1][m] = rr[0]*rm[4][0][1][m+1]-4.0*rm[3][0][1][m+1];
    rm[1][5][0][m] = rr[1]*rm[1][4][0][m+1]-4.0*rm[1][3][0][m+1];
    rm[0][5][1][m] = rr[1]*rm[0][4][1][m+1]-4.0*rm[0][3][1][m+1];
    rm[1][0][5][m] = rr[2]*rm[1][0][4][m+1]-4.0*rm[1][0][3][m+1];
    rm[0][1][5][m] = rr[2]*rm[0][1][4][m+1]-4.0*rm[0][1][3][m+1];
    /* (6,0,0) type */
    rm[6][0][0][m] = rr[0]*rm[5][0][0][m+1]-5.0*rm[4][0][0][m+1];
    rm[0][6][0][m] = rr[1]*rm[0][5][0][m+1]-5.0*rm[0][4][0][m+1];
    rm[0][0][6][m] = rr[2]*rm[0][0][5][m+1]-5.0*rm[0][0][4][m+1];
    }
  if (lt<7)
    return(1);
  /* [7]^m integrals */
  for (m=0; m<=(lt-7); m++) {
    /* (3,2,2) type */
    rm[3][2][2][m] = rr[0]*rm[2][2][2][m+1]-2.0*rm[1][2][2][m+1];
    rm[2][3][2][m] = rr[1]*rm[2][2][2][m+1]-2.0*rm[2][1][2][m+1];
    rm[2][2][3][m] = rr[2]*rm[2][2][2][m+1]-2.0*rm[2][2][1][m+1];
    /* (3,3,1) type */
    rm[3][3][1][m] = rr[1]*rm[3][2][1][m+1]-2.0*rm[3][1][1][m+1];
    rm[3][1][3][m] = rr[2]*rm[3][1][2][m+1]-2.0*rm[3][1][1][m+1];
    rm[1][3][3][m] = rr[2]*rm[1][3][2][m+1]-2.0*rm[1][3][1][m+1];
    /* (4,3,0) type */
    rm[4][3][0][m] = rr[0]*rm[3][3][0][m+1]-3.0*rm[2][3][0][m+1];
    rm[4][0][3][m] = rr[0]*rm[3][0][3][m+1]-3.0*rm[2][0][3][m+1];
    rm[3][4][0][m] = rr[1]*rm[3][3][0][m+1]-3.0*rm[3][2][0][m+1];
    rm[0][4][3][m] = rr[1]*rm[0][3][3][m+1]-3.0*rm[0][2][3][m+1];
    rm[3][0][4][m] = rr[2]*rm[3][0][3][m+1]-3.0*rm[3][0][2][m+1];
    rm[0][3][4][m] = rr[2]*rm[0][3][3][m+1]-3.0*rm[0][3][2][m+1];
    /* (4,2,1) type */
    rm[4][2][1][m] = rr[0]*rm[3][2][1][m+1]-3.0*rm[2][2][1][m+1];
    rm[4][1][2][m] = rr[0]*rm[3][1][2][m+1]-3.0*rm[2][1][2][m+1];
    rm[2][4][1][m] = rr[1]*rm[2][3][1][m+1]-3.0*rm[2][2][1][m+1];
    rm[1][4][2][m] = rr[1]*rm[1][3][2][m+1]-3.0*rm[1][2][2][m+1];
    rm[2][1][4][m] = rr[2]*rm[2][1][3][m+1]-3.0*rm[2][1][2][m+1];
    rm[1][2][4][m] = rr[2]*rm[1][2][3][m+1]-3.0*rm[1][2][2][m+1];
    /* (5,2,0) type */
    rm[5][2][0][m] = rr[0]*rm[4][2][0][m+1]-4.0*rm[3][2][0][m+1];
    rm[5][0][2][m] = rr[0]*rm[4][0][2][m+1]-4.0*rm[3][0][2][m+1];
    rm[2][5][0][m] = rr[1]*rm[2][4][0][m+1]-4.0*rm[2][3][0][m+1];
    rm[0][5][2][m] = rr[1]*rm[0][4][2][m+1]-4.0*rm[0][3][2][m+1];
    rm[2][0][5][m] = rr[2]*rm[2][0][4][m+1]-4.0*rm[2][0][3][m+1];
    rm[0][2][5][m] = rr[2]*rm[0][2][4][m+1]-4.0*rm[0][2][3][m+1];
    /* (5,1,1) type */
    rm[5][1][1][m] = rr[0]*rm[4][1][1][m+1]-4.0*rm[3][1][1][m+1];
    rm[1][5][1][m] = rr[1]*rm[1][4][1][m+1]-4.0*rm[1][3][1][m+1];
    rm[1][1][5][m] = rr[2]*rm[1][1][4][m+1]-4.0*rm[1][1][3][m+1];
    /* (6,1,0) type */
    rm[6][1][0][m] = rr[0]*rm[5][1][0][m+1]-5.0*rm[4][1][0][m+1];
    rm[6][0][1][m] = rr[0]*rm[5][0][1][m+1]-5.0*rm[4][0][1][m+1];
    rm[1][6][0][m] = rr[1]*rm[1][5][0][m+1]-5.0*rm[1][4][0][m+1];
    rm[0][6][1][m] = rr[1]*rm[0][5][1][m+1]-5.0*rm[0][4][1][m+1];
    rm[1][0][6][m] = rr[2]*rm[1][0][5][m+1]-5.0*rm[1][0][4][m+1];
    rm[0][1][6][m] = rr[2]*rm[0][1][5][m+1]-5.0*rm[0][1][4][m+1];
    /* (7,0,0) type */
    rm[7][0][0][m] = rr[0]*rm[6][0][0][m+1]-6.0*rm[5][0][0][m+1];
    rm[0][7][0][m] = rr[1]*rm[0][6][0][m+1]-6.0*rm[0][5][0][m+1];
    rm[0][0][7][m] = rr[2]*rm[0][0][6][m+1]-6.0*rm[0][0][5][m+1];
    }
  if (lt<8)
    return(1);
  /* [8]^m integrals */
  for (m=0; m<=(lt-8); m++) {
    /* (3,3,2) type */
    rm[3][3][2][m] = rr[1]*rm[3][2][2][m+1]-2.0*rm[3][1][2][m+1];
    rm[3][2][3][m] = rr[2]*rm[3][2][2][m+1]-2.0*rm[3][2][1][m+1];
    rm[2][3][3][m] = rr[2]*rm[2][3][2][m+1]-2.0*rm[2][3][1][m+1];
    /* (4,4,0) type */
    rm[4][4][0][m] = rr[1]*rm[4][3][0][m+1]-3.0*rm[4][2][0][m+1];
    rm[4][0][4][m] = rr[2]*rm[4][0][3][m+1]-3.0*rm[4][0][2][m+1];
    rm[0][4][4][m] = rr[2]*rm[0][4][3][m+1]-3.0*rm[0][4][2][m+1];
    /* (4,3,1) type */
    rm[4][3][1][m] = rr[0]*rm[3][3][1][m+1]-3.0*rm[2][3][1][m+1];
    rm[4][1][3][m] = rr[0]*rm[3][1][3][m+1]-3.0*rm[2][1][3][m+1];
    rm[3][4][1][m] = rr[1]*rm[3][3][1][m+1]-3.0*rm[3][2][1][m+1];
    rm[1][4][3][m] = rr[1]*rm[1][3][3][m+1]-3.0*rm[1][2][3][m+1];
    rm[3][1][4][m] = rr[2]*rm[3][1][3][m+1]-3.0*rm[3][1][2][m+1];
    rm[1][3][4][m] = rr[2]*rm[1][3][3][m+1]-3.0*rm[1][3][2][m+1];
    /* (4,2,2) type */
    rm[4][2][2][m] = rr[0]*rm[3][2][2][m+1]-3.0*rm[2][2][2][m+1];
    rm[2][4][2][m] = rr[1]*rm[2][3][2][m+1]-3.0*rm[2][2][2][m+1];
    rm[2][2][4][m] = rr[2]*rm[2][2][3][m+1]-3.0*rm[2][2][2][m+1];
    /* (5,3,0) type */
    rm[5][3][0][m] = rr[0]*rm[4][3][0][m+1]-4.0*rm[3][3][0][m+1];
    rm[5][0][3][m] = rr[0]*rm[4][0][3][m+1]-4.0*rm[3][0][3][m+1];
    rm[3][5][0][m] = rr[1]*rm[3][4][0][m+1]-4.0*rm[3][3][0][m+1];
    rm[0][5][3][m] = rr[1]*rm[0][4][3][m+1]-4.0*rm[0][3][3][m+1];
    rm[3][0][5][m] = rr[2]*rm[3][0][4][m+1]-4.0*rm[3][0][3][m+1];
    rm[0][3][5][m] = rr[2]*rm[0][3][4][m+1]-4.0*rm[0][3][3][m+1];
    /* (5,2,1) type */
    rm[5][2][1][m] = rr[0]*rm[4][2][1][m+1]-4.0*rm[3][2][1][m+1];
    rm[5][1][2][m] = rr[0]*rm[4][1][2][m+1]-4.0*rm[3][1][2][m+1];
    rm[2][5][1][m] = rr[1]*rm[2][4][1][m+1]-4.0*rm[2][3][1][m+1];
    rm[1][5][2][m] = rr[1]*rm[1][4][2][m+1]-4.0*rm[1][3][2][m+1];
    rm[2][1][5][m] = rr[2]*rm[2][1][4][m+1]-4.0*rm[2][1][3][m+1];
    rm[1][2][5][m] = rr[2]*rm[1][2][4][m+1]-4.0*rm[1][2][3][m+1];
    /* (6,2,0) type */
    rm[6][2][0][m] = rr[0]*rm[5][2][0][m+1]-5.0*rm[4][2][0][m+1];
    rm[6][0][2][m] = rr[0]*rm[5][0][2][m+1]-5.0*rm[4][0][2][m+1];
    rm[2][6][0][m] = rr[1]*rm[2][5][0][m+1]-5.0*rm[2][4][0][m+1];
    rm[0][6][2][m] = rr[1]*rm[0][5][2][m+1]-5.0*rm[0][4][2][m+1];
    rm[2][0][6][m] = rr[2]*rm[2][0][5][m+1]-5.0*rm[2][0][4][m+1];
    rm[0][2][6][m] = rr[2]*rm[0][2][5][m+1]-5.0*rm[0][2][4][m+1];
    /* (6,1,1) type */
    rm[6][1][1][m] = rr[0]*rm[5][1][1][m+1]-5.0*rm[4][1][1][m+1];
    rm[1][6][1][m] = rr[1]*rm[1][5][1][m+1]-5.0*rm[1][4][1][m+1];
    rm[1][1][6][m] = rr[2]*rm[1][1][5][m+1]-5.0*rm[1][1][4][m+1];
    /* (7,1,0) type */
    rm[7][1][0][m] = rr[0]*rm[6][1][0][m+1]-6.0*rm[5][1][0][m+1];
    rm[7][0][1][m] = rr[0]*rm[6][0][1][m+1]-6.0*rm[5][0][1][m+1];
    rm[1][7][0][m] = rr[1]*rm[1][6][0][m+1]-6.0*rm[1][5][0][m+1];
    rm[0][7][1][m] = rr[1]*rm[0][6][1][m+1]-6.0*rm[0][5][1][m+1];
    rm[1][0][7][m] = rr[2]*rm[1][0][6][m+1]-6.0*rm[1][0][5][m+1];
    rm[0][1][7][m] = rr[2]*rm[0][1][6][m+1]-6.0*rm[0][1][5][m+1];
    /* (8,0,0) type */
    rm[8][0][0][m] = rr[0]*rm[7][0][0][m+1]-7.0*rm[6][0][0][m+1];
    rm[0][8][0][m] = rr[1]*rm[0][7][0][m+1]-7.0*rm[0][6][0][m+1];
    rm[0][0][8][m] = rr[2]*rm[0][0][7][m+1]-7.0*rm[0][0][6][m+1];
    }
  if (lt<9) 
    return(1);
  return(0);
  }

/* -------------------------------------------------------------------------- */
